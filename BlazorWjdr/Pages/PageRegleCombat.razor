@page "/regles/combat/"

@using BlazorWjdr.Components.Competence
@using BlazorWjdr.Components.Arme
@using BlazorWjdr.Components.Talent
@using BlazorWjdr.Components.Regle
@using BlazorWjdr.Components.Table
@using BlazorWjdr.Components.Trait
@using BlazorWjdr.Models
@using BlazorWjdr.Services

@inject ReglesService _reglesService
@inject TablesService _tablesService
@inject TraitsService _traitsService
@inject CompetencesEtTalentsService _competencesEtTalentsService
@inject ArmesService _armesService

<MainTopRow>
    <h3 class="card-title">Déroulement d'une bataille</h3>
</MainTopRow>

<div class="content px-4">

    <img class="shadow p-1 mb-5 bg-white rounded" src="/images/ambiance/bataille.png" alt="Baston !!!"/>
    
    <div class="row">
        <div class="col-6">
            <PageSectionRowTitle Title="1. Effet de surprise"/>
            <div class="card-body">
                
                <p class="card-text">
                    Le MJ détermine si certains combattants sont <em>Supris</em>. Cela ne peut normalement arriver qu'au premier Round.<br/>
                    Les combattants qui possèdent le talent <TalentItem Item="@_competencesEtTalentsService.TalentSurSesGardes"/> ont une chance d'éviter d'être <TraitItem Item="@_traitsService.ConditionSurpris"/>.
                </p>

                <p class="card-text">
                    Prendre l'ennemi par surprise confère un énorme avantage. Si l'un des camps prépare une attaque, il peut tenter de profiter de l'effet de suprise en :
                    <ul>
                        <li><strong>Dissimulation : </strong>réussir un test de <CompetenceItem Item="@_competencesEtTalentsService.CompetenceDissimulation"/> approprié. Les victimes peuvent y opposer un test de <CompetenceItem Item="@_competencesEtTalentsService.CompetencePerception"/> s'il sont sur leurs gardes ou selon l'humeur du MJ.</li>
                        <li><strong>Attaque sournoise : </strong>attaque dans le dos, dans l'ombre, à travers un épais brouillard ou depuis le ciel ! Selon les conditions et l'humeur du MJ, les victimes peuvent y opposer un test de <CompetenceItem Item="@_competencesEtTalentsService.CompetencePerception"/> s'il sont sur leurs gardes.</li>
                        <li><strong>Diversion : </strong>forte détonation, foule de pénitents menée par un sermon particulièrement engageant sont des exemples qui peuvent couvrir une attaque surprise.</li>
                        <li><strong>Pris au dépourvu : </strong>s'il l'ennemi n'est particulièrement pas préparé à une attaque, l'effet de surprise est automatique.</li>
                        <li><strong>Autre chose : </strong>tout autre plan sournois ou ingénieux concoté par des joueurs méticuleux.</li>
                    </ul>
                    S'il y a une chance pour que les embusqués soient repérés, le MJ appèlera un test opposé <CompetenceItem Item="@_competencesEtTalentsService.CompetenceDissimulation"/> <strong>vs</strong> <CompetenceItem Item="@_competencesEtTalentsService.CompetencePerception"/>, généralement avec le personnage qui a la plus faible valeur en Dissimultion opposé à toutes les sentinelles potentielles.
                    Ceux qui échouent sont <TraitItem Item="@_traitsService.ConditionSurpris"/>.
                    <br/>
                    Le MJ peut également effectuer un test d'<CompetenceItem Item="@_competencesEtTalentsService.CompetenceIntuition"/> pour les personnages possédant un <TalentItem Item="_competencesEtTalentsService.TalentSixiemeSens"/> qui éviteront de justesse d'être Surpris, sans pour autant avoir le temps de prévenir les autres.
                </p>

            </div>
        </div>
        <div class="col-6">
            <PageSectionRowTitle Title="2. Initiative de combat"/>
            <div class="card-body">
                <p class="card-text">
                    Chaque combattant lance 1d10 et y ajoute son bonus d'Initiative et son bonus d'Agilité.<br/>
                    Les combattants disposant de <TalentItem Item="@_competencesEtTalentsService.TalentReflexesDeCombat"/> ont un bonus supplémentaire.
                </p>
                <p class="card-text">
                    Durant chaque Round, les combatants joueront leur Tour dans l'ordre du score le plus fort au plus faible.
                </p>
            </div>
            
            <PageSectionRowTitle Title="3. Début du Round"/>
            <div class="card-body">
                <p class="card-text">
                    Si des règles s'appliquent au début du Round, elles s'appliquent maintenant.
                    <br/>
                    <ul>
                        <li><TalentItem Item="@_competencesEtTalentsService.TalentTirEclair"/></li>
                    </ul>
                </p>
            </div>
        </div>
    </div>

    <PageSectionDivider/>

    <div class="row">
        <div class="col-4">
            <PageSectionRowTitle Title="4. Chaque combattant joue son Tour"/>
            <div class="card-body">
                <p class="card-text">
                    Cela dans l'ordre défini par l'Initiative de combat.
                    <br/>
                    Chaque combattant peut normalement effectuer un Déplacement et une Action pendant son Tour.
                </p>
                <p class="card-text">
                    Le MJ décrit votre situation - ou se trouve chaque combattant et ce qui vous entoure - et vous pouvez poser des questions supplémentaires pour planifier votre Tour.
                    <br/>
                    On détermine si le personnage actif est en supériorité numérique, en prenant en compte l'évetuelle <TalentItem Item="_competencesEtTalentsService.TalentPresenceImposante"/> de ses adversaires :
                    <ul>
                        <li>à raison de 2 contre 1, l'attaquant gagne un bonus de +20 en CC.</li>
                        <li>à raison de 3 contre 1, l'attaquant gagne un bonus de +40 en CC.</li>
                    </ul>
                    <br/>
                    Vous pouvez effectuer votre Déplacement et votre Action dans l'ordre souhaité, ou en même temps en décrivant comment vous combinez les deux.
                </p>
            </div>
            <TableDetail Item="@_tablesService.GetTable(65)"></TableDetail>
        </div>
        <div class="col-4">
            <TableDetail Item="@_tablesService.GetTable(66)"></TableDetail>
            <div class="card-body">
                <p class="card-text">
                    Si un combattant est <strong>plus petit</strong> que son adversaire :
                    <ul>
                        <li>en attaque, il gagne un bonus de +10 en CC pour toucher (uniquement).</li>
                        <li>en défense, il subit un malus de -2 BS pour chaque écart de taille quand il utilise sa CC pour un Test Opposé.</li>
                        <li>pour remporter un Test Opposé de Force, il doit faire une Réussite Critique s'il n'a qu'une taille de moins ; au delà l'échec est automatique.</li>
                    </ul>
                </p>
                <p class="card-text">
                    Si un combattant est <strong>plus grand</strong> que son adversaire :
                    <ul>
                        <li>son arme devient <AttributDArmeItem Item="@_armesService.AttributDamaging"/> s'il est <strong>plus grand d'une taille</strong>.</li>
                        <li>son arme devient <AttributDArmeItem Item="@_armesService.AttributPercutant"/> s'il est <strong>plus grand de deux tailles</strong> ou plus.</li>
                        <li>ses dégâts sont multipliés par l'écart de taille - Large vs Moyen = normaux ; Enorme vs Moyen = x2 ; Monstrueux vs Moyen = x3.</li>
                        <li>tous ses coups qui touchent une cible plus petite déclenchent la règle du <em>Coup Fatal</em>, même si la cible survit.</li>
                        <li>il cause la <em>Peur</em> à ses adversaires <strong>plus petits d'une taille</strong>, et au delà la <em>Terreur</em> avec un Taux égal à l'écart de taille.</li>
                        <li>une fois par Round, il peut dépenser 1 Avantage pour effectuer un Pietinement en attaque gratuite (inflige BS+0 en utilisant ses poings/pieds/armes naturelles).</li>
                        <li>il ignore la nécessité de se Désengager pour quitter le combat ; il se contente de se déplacer où il veut en balayant devant lui.</li>
                    </ul>
                </p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-5">
            <h5 class="card-title">Fin du Round</h5>
            <p class="card-text">
                Les personnages en infériorité numérique perdent 1 Avantage.
                
            </p>
        </div>
        <div class="col-1">
        </div>
        <div class="col-5">
            
        </div>
    </div>
</div>