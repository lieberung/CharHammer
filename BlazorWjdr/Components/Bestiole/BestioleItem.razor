@using BlazorWjdr.Shared.Oi
@using BlazorWjdr.Models

<a href="creatures/@Item.Id.ToString()/" class="btn btn-light btn-item">
    @if (Item.EstUnPersonnageJoueur)
    {
        <Tooltip Text="@_tooltipNomJoueur">
            <span class="oi oi-person item-icon ml-1 mr-1" aria-hidden="true"></span>
        </Tooltip>
    }
    else if (Item.EstUnPersonnage && Item.EstUnPersonnageJoueur == false)
    {
        <Tooltip Text="@Item.Description">
            <span class="oi oi-person item-icon mr-1" aria-hidden="true"></span>
        </Tooltip>
    }
    else
    {
        <Tooltip Text="@Item.Description">
            <span class="oi oi-bug item-icon ml-1 mr-1" aria-hidden="true"></span>
        </Tooltip>
    }
    <span>@Item.Nom</span>
    @if (Item.CheminementPro.Any())
    {
        <span>, @Item.CarriereActuelle?.Nom @_nomRace</span>
    }
    @if (!Item.EstUnPersonnageJoueur && !string.IsNullOrWhiteSpace(Item.Notes))
    {
        <ItemInfoRed TootipText="@Item.Notes"/>
    }
    @ChildContent
</a>
@code{
    [Parameter] public BestioleDto Item { get; set; } = null!;
    [Parameter] public RenderFragment ChildContent { get; set; } = null!;

    private string _nomRace = "";
    private string _origines = "inconnu";
    private string _tooltipNomJoueur = "";
    
    protected override void OnParametersSet()
    {
        _nomRace = (Item.Sexe == 1 || string.IsNullOrWhiteSpace(Item.Race.NomFeminin) ? Item.Race.NomMasculin : Item.Race.NomFeminin).ToLower();
        if (Item.Origines.Any())
        {
            _origines = Item.Origines.First().Nom ?? "";
            if (Item.Origines.First().Parent != null)
                _origines += $", {Item.Origines.First().Parent!.Nom}";
        }

        if (Item.EstUnPersonnageJoueur)
            _tooltipNomJoueur = $"Créé le {Item.DateDeCreation} par {Item.Joueur}\nOrigines : {_origines}\n{Item.Notes}";
        
        base.OnParametersSet();
    }

}