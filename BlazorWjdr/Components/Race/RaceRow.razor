@using BlazorWjdr.Models
@using BlazorWjdr.Services
@using BlazorWjdr.Components.Carriere
@using BlazorWjdr.Components.Lieu
@using BlazorWjdr.Shared.Oi

@inject CarrieresService _carrieresService
<tr>
    <td>
        @if (@Item.Profil != null)
        {
            <span class="btn btn-primary btn-item-action table-btn mr-1" @onclick="_ => AfficherProfil = !AfficherProfil">
                <span class="oi oi-grid-four-up" aria-hidden="true"></span>
            </span>
        }
    </td>
    <td>
        @if (Item.SousElements.Any())
        {
            <span class="btn btn-primary btn-item-action table-btn mr-1" @onclick="_ => AfficherSousElements = !AfficherSousElements">
                <span class="oi oi-layers" aria-hidden="true"></span>
            </span>
        }
    </td>
    <td>
        @for (var i = 0; i < Item.ParentsCount; i++)
        {
            var hidden = i < Item.ParentsCount - 1;
            <SousElement Hidden="@hidden"/>
        }
        <RaceItem Item="@Item" />
    </td>
    <td><CheckedIfTrue Condition="@Item.PourPj"/></td>
    <td>@Item.Description</td>
    <td>
        @foreach (var lieu in Item.Lieux)
        {
            <LieuItem Item="lieu"/>
        }
    </td>
</tr>
@if (AfficherProfil && @Item.Profil != null)
{
    <tr>
        <td colspan="7" class="p-3">
            <div class="bulle">
                <h6 class="card-title">Caractéristiques (2d10)</h6>
                <Profil CaracteristiqueDeDepart="@Item.Profil"/>
            </div>
        </td>
    </tr>
}
@if (AfficherSousElements && Item.SousElements.Any())
{
    @foreach (var sousElement in Item.SousElements)
    {
        <RaceRow Item="@sousElement" />
    }
}
@code
{
    [Parameter]
    public RaceDto Item { get; set; } = null!;
    private bool AfficherSousElements { get; set; } = false;
    private bool AfficherProfil { get; set; } = false;
}